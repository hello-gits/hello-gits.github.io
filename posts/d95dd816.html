<!DOCTYPE HTML>
<html lang="zh-CN">


<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta name="keywords" content="Kafka总结（五）Kafka 命令行详解下、配置、副本、测试等相关命令, hnbian">
    <meta name="description" content="
脚本列表




序号
脚本
功能



1
connect-distributed.sh &amp;amp;&amp;amp; connect-standalone.sh
连接kafka集群/单机模式


2
kafka-run-class.sh
执行">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Kafka总结（五）Kafka 命令行详解下、配置、副本、测试等相关命令 | hnbian</title>
    <link rel="icon" type="image/png" href="https://images.hnbian.cn/FvNSAGx7xljxALFh8Fa2DPNFP-JB">

    <link rel="stylesheet" type="text/css" href="https://images.hnbian.cn/all.css">
    <link rel="stylesheet" type="text/css" href="https://images.hnbian.cn/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="https://images.hnbian.cn/aos.css">
    <link rel="stylesheet" type="text/css" href="https://images.hnbian.cn/animate.min.css">
    <link rel="stylesheet" type="text/css" href="https://images.hnbian.cn/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">
    
    <script src="https://images.hnbian.cn/jquery.min.mind.js"></script>
    <script data-ad-client="ca-pub-5756598031349071" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <meta name="google-site-verification" content="GrFMoauFrf8T4o0YL7D2b8YqhXQwVruyJKGw57gZ8J4">
<link rel="alternate" href="/atom.xml" title="hnbian" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper head-container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="https://images.hnbian.cn/FvNSAGx7xljxALFh8Fa2DPNFP-JB" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">hnbian</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/graph" class="waves-effect waves-light">
      
      <i class="fa fa-graduation-cap" style="zoom: 0.6;"></i>
      
      <span>知识图谱</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>

<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="https://images.hnbian.cn/FvNSAGx7xljxALFh8Fa2DPNFP-JB" class="logo-img circle responsive-img">
        
        <div class="logo-name">hnbian</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/graph" class="waves-effect waves-light">
			
			    <i class="fa-fw fa fa-graduation-cap"></i>
			
			知识图谱
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			关于
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/hnbian" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>

        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/hnbian" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('https://images.hnbian.cn/FvmeV3u0Ls5G69wcDwxAwadloicx')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">Kafka总结（五）Kafka 命令行详解下、配置、副本、测试等相关命令</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="https://images.hnbian.cn/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        height: calc(100vh - 250px);
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/kafka/">
                                <span class="chip bg-color">kafka</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/kafka/" class="post-category">
                                kafka
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2020-02-19
                </div>
                

                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    5.6k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    27 分
                </div>
                
				
                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
            
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <ul>
<li>脚本列表</li>
</ul>
<table>
<thead>
<tr>
<th>序号</th>
<th>脚本</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>connect-distributed.sh &amp;&amp; connect-standalone.sh</td>
<td>连接kafka集群/单机模式</td>
</tr>
<tr>
<td>2</td>
<td>kafka-run-class.sh</td>
<td>执行kafka.tools的部分功能</td>
</tr>
<tr>
<td>3</td>
<td>kafka-reassign-partitions.sh</td>
<td>分区重分配脚本</td>
</tr>
<tr>
<td>4</td>
<td>kafka-configs.sh</td>
<td>配置管理脚本</td>
</tr>
<tr>
<td>5</td>
<td>kafka-delete-records.sh</td>
<td>删除低水位的数据</td>
</tr>
<tr>
<td>6</td>
<td>kafka-log-dirs.sh</td>
<td>kafka消息日志目录信息</td>
</tr>
<tr>
<td>7</td>
<td>kafka-preferred-replica-election.sh</td>
<td>触发preferred replica选举</td>
</tr>
<tr>
<td>8</td>
<td>kafka-replica-verification.sh</td>
<td>复制进度验证脚本</td>
</tr>
<tr>
<td>9</td>
<td>kafka-mirror-maker.sh</td>
<td>不同数据中心kafka集群复制工具</td>
</tr>
<tr>
<td>10</td>
<td>kafka-acls.sh</td>
<td>权限管理</td>
</tr>
<tr>
<td>11</td>
<td>kafka-streams-application-reset.sh</td>
<td>kafka stream 命令</td>
</tr>
</tbody></table>
<h2 id="1-connect-distributed-sh-amp-amp-connect-standalone-sh"><a href="#1-connect-distributed-sh-amp-amp-connect-standalone-sh" class="headerlink" title="1. connect-distributed.sh &amp;&amp; connect-standalone.sh"></a>1. connect-distributed.sh &amp;&amp; connect-standalone.sh</h2><p>Kafka Connect是在0.9以后加入的功能，主要是用来将其他系统的数据导入到Kafka,然后再将Kafka中的数据导出到另外的系统。可以用来做实时数据同步的ETL，数据实时分析处理等。<br>主要有2种模式：Standalone（单机模式）和Distribute（分布式模式）。<br>单机主要用来开发，测试，分布式的用于生产环境。<br>用法比较复杂，建议参考：<a href="https://www.orchome.com/344" target="_blank" rel="noopener">https://www.orchome.com/344</a></p>
<h2 id="2-kafka-run-class-sh"><a href="#2-kafka-run-class-sh" class="headerlink" title="2. kafka-run-class.sh"></a>2. kafka-run-class.sh</h2><ul>
<li>功能：USAGE: ./kafka-run-class.sh [-daemon] [-name servicename] [-loggc] classname [opts]</li>
</ul>
<p>参数说明</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>–group <string></string></td>
<td>消费组</td>
</tr>
<tr>
<td>–output-file <string></string></td>
<td>输出文件</td>
</tr>
<tr>
<td>–zkconnect <string></string></td>
<td>zookeeper连接字符串</td>
</tr>
<tr>
<td>–help</td>
<td>打印帮助信息</td>
</tr>
</tbody></table>
<pre class=" language-bash"><code class="language-bash">
<span class="token punctuation">[</span>root@node2 bin<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ./kafka-run-class.sh kafka.tools.ExportZkOffsets --zkconnect node1:2181 --group console-consumer-64682 --output-file out_offsets</span>
<span class="token punctuation">[</span>2020-02-19 23:21:22,209<span class="token punctuation">]</span> WARN WARNING: ExportZkOffsets is deprecated and will be dropped <span class="token keyword">in</span> a future release following 0.11.0.0. <span class="token punctuation">(</span>kafka.tools.ExportZkOffsets$<span class="token punctuation">)</span>


<span class="token comment" spellcheck="true"># 查看导出文件</span>
<span class="token punctuation">[</span>root@node2 bin<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cat out_offsets</span>
/consumers/console-consumer-64682/offsets/test7/0:2
/consumers/console-consumer-64682/offsets/test7/1:1
/consumers/console-consumer-64682/offsets/test7/2:2

<span class="token comment" spellcheck="true"># segment片段信息</span>
<span class="token punctuation">[</span>root@node2 bin<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ./kafka-run-class.sh kafka.tools.DumpLogSegments --files ../kafka-logs/test8-0/00000000000000000000.log</span>
Dumping <span class="token punctuation">..</span>/kafka-logs/test8-0/00000000000000000000.log
Starting offset: 0
baseOffset: 0 lastOffset: 1 baseSequence: -1 lastSequence: -1 producerId: -1 producerEpoch: -1 partitionLeaderEpoch: 0 isTransactional: <span class="token boolean">false</span> position: 0 CreateTime: 1582105410382 isvalid: <span class="token boolean">true</span> size: 78 magic: 2 compresscodec: NONE crc: 4147696842
baseOffset: 2 lastOffset: 3 baseSequence: -1 lastSequence: -1 producerId: -1 producerEpoch: -1 partitionLeaderEpoch: 0 isTransactional: <span class="token boolean">false</span> position: 78 CreateTime: 1582105433073 isvalid: <span class="token boolean">true</span> size: 78 magic: 2 compresscodec: NONE crc: 3173743410
baseOffset: 4 lastOffset: 4 baseSequence: -1 lastSequence: -1 producerId: -1 producerEpoch: -1 partitionLeaderEpoch: 0 isTransactional: <span class="token boolean">false</span> position: 156 CreateTime: 1582105443091 isvalid: <span class="token boolean">true</span> size: 70 magic: 2 compresscodec: NONE crc: 3076317218
baseOffset: 5 lastOffset: 5 baseSequence: -1 lastSequence: -1 producerId: -1 producerEpoch: -1 partitionLeaderEpoch: 0 isTransactional: <span class="token boolean">false</span> position: 226 CreateTime: 1582106506420 isvalid: <span class="token boolean">true</span> size: 70 magic: 2 compresscodec: NONE crc: 1906249676
baseOffset: 6 lastOffset: 6 baseSequence: -1 lastSequence: -1 producerId: -1 producerEpoch: -1 partitionLeaderEpoch: 0 isTransactional: <span class="token boolean">false</span> position: 296 CreateTime: 1582106508354 isvalid: <span class="token boolean">true</span> size: 70 magic: 2 compresscodec: NONE crc: 253490739


<span class="token punctuation">[</span>root@node2 bin<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ./kafka-run-class.sh kafka.tools.DumpLogSegments --files ../kafka-logs/test8-0/00000000000000000000.index</span>
Dumping <span class="token punctuation">..</span>/kafka-logs/test8-0/00000000000000000000.index
offset: 0 position: 0
</code></pre>
<h2 id="3-kafka-reassign-partitions-sh"><a href="#3-kafka-reassign-partitions-sh" class="headerlink" title="3. kafka-reassign-partitions.sh"></a>3. kafka-reassign-partitions.sh</h2><ul>
<li>功能：此命令在副本之间移动主题分区。</li>
</ul>
<p>参数说明</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td><strong>–zookeeper &lt;String: urls&gt;</strong></td>
<td>Zookeeper连接的连接字符串，格式为host:port，多个用逗号隔开</td>
</tr>
<tr>
<td>–reassignment-json-file &lt;String:  manual assignment json file path&gt;</td>
<td>要使用的格式是- {“partition “: [{“topic”: “foo”， “partition”: 1， “replicas”: [1,2,3]， “log_dirs”: [“dir1”，”dir2”，”dir3”]}]， “version”:1}注意，” log_dirs”是可选的。当它被指定时，它的长度必须等于副本列表的长度。此列表中的值可以是代理上的日志目录的”any”或赦免路径。如果指定了绝对日志目录路径，则当前需要的是尚未在该代理上创建副本。随后将在代理上的指定日志目录中创建副本。</td>
</tr>
<tr>
<td>–verify</td>
<td>验证重新分配是否按照—resignment - json-file选项指定的方式完成。如果存在为指定的副本占用的节流阀，并且重新平衡已经完成，则节流阀将被移除</td>
</tr>
<tr>
<td>–execute</td>
<td>按照–sign -json-file选项指定的方式开始重新分配</td>
</tr>
<tr>
<td>–bootstrap-server &lt;String: Server(s) to use for bootstrapping&gt;</td>
<td>用于引导的服务器。 为重新分配json文件中的任何副本指定了日志导向器的绝对路径所需</td>
</tr>
<tr>
<td>–broker-list &lt;String: brokerlist&gt;</td>
<td>需要以”0,1,2”的形式重新分配分区的broker列表。如果使用-topic-to-move-json-file生成重新分配配置，则需要这样做</td>
</tr>
<tr>
<td>–generate</td>
<td>生成一个候选分区重新分配配置。注意，这只生成一个候选赋值，而不执行它。</td>
</tr>
<tr>
<td>–throttle &lt;Long: throttle&gt;</td>
<td>分区的移动将被调整到这个值(字节/秒)。重新运行此选项，而一个平衡正在进行中，将改变油门值。节流速率至少为1kb /s。(默认值:1)</td>
</tr>
<tr>
<td>–timeout &lt;Long: timeout&gt;</td>
<td>允许等待成功启动分区重分配执行的最长时间(默认值:10000)</td>
</tr>
<tr>
<td>–topics-to-move-json-file &lt;String: topics to reassign json file path&gt;</td>
<td>生成一个重新分配配置，将指定主题的分区移动到由–broker- list选项指定的代理列表中。使用的格式是- {“topics”: [{“topic”: “foo”}，{“topic”: “foo1”}]， “version”:1}</td>
</tr>
<tr>
<td>–disable-rack-aware</td>
<td>禁用支持机架的复制分配</td>
</tr>
</tbody></table>
<h3 id="3-1-移动副本位置"><a href="#3-1-移动副本位置" class="headerlink" title="3.1 移动副本位置"></a>3.1 移动副本位置</h3><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 查看副本状态</span>
<span class="token punctuation">[</span>root@node1 bin<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ./kafka-topics.sh --zookeeper node1:2181,node2:2181,node3:2181 --topic test8 --describe</span>
Topic:test8    PartitionCount:2    ReplicationFactor:1    Configs:
    Topic: test8    Partition: 0    Leader: 1    Replicas: 1    Isr: 1
    Topic: test8    Partition: 1    Leader: 2    Replicas: 2    Isr: 2

<span class="token comment" spellcheck="true"># 把 partition 0 副本移动到 broker 2，把 partition 1 副本移动到 broker 0，</span>


编辑副本移动文件 放入 topic-reassignment.json 文件中
<span class="token punctuation">{</span><span class="token string">"partitions"</span>:<span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">"topic"</span><span class="token keyword">:</span><span class="token string">"test8"</span>,<span class="token string">"partition"</span>:0,<span class="token string">"replicas"</span>:<span class="token punctuation">[</span>2<span class="token punctuation">]</span><span class="token punctuation">}</span>,<span class="token punctuation">{</span><span class="token string">"topic"</span><span class="token keyword">:</span><span class="token string">"test8"</span>,<span class="token string">"partition"</span>:1,<span class="token string">"replicas"</span>:<span class="token punctuation">[</span>0<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">]</span>,<span class="token string">"version"</span>:1<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true"># 执行副本移动</span>
<span class="token punctuation">[</span>root@node1 bin<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ./kafka-reassign-partitions.sh --zookeeper node1:2181 --reassignment-json-file ./topic-reassignment.json --execute</span>
Current partition replica assignment

<span class="token punctuation">{</span><span class="token string">"version"</span>:1,<span class="token string">"partitions"</span>:<span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">"topic"</span><span class="token keyword">:</span><span class="token string">"test8"</span>,<span class="token string">"partition"</span>:0,<span class="token string">"replicas"</span>:<span class="token punctuation">[</span>1<span class="token punctuation">]</span>,<span class="token string">"log_dirs"</span>:<span class="token punctuation">[</span><span class="token string">"any"</span><span class="token punctuation">]</span><span class="token punctuation">}</span>,<span class="token punctuation">{</span><span class="token string">"topic"</span><span class="token keyword">:</span><span class="token string">"test8"</span>,<span class="token string">"partition"</span>:1,<span class="token string">"replicas"</span>:<span class="token punctuation">[</span>2<span class="token punctuation">]</span>,<span class="token string">"log_dirs"</span>:<span class="token punctuation">[</span><span class="token string">"any"</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span>

Save this to use as the --reassignment-json-file option during rollback
Successfully started reassignment of partitions.

<span class="token comment" spellcheck="true">#查看topic分区分布情况，确实按照我们的配置修改了位置</span>
<span class="token punctuation">[</span>root@node1 bin<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ./kafka-topics.sh --zookeeper node1:2181,node2:2181,node3:2181 --topic test8 --describe</span>
Topic:test8    PartitionCount:2    ReplicationFactor:1    Configs:
    Topic: test8    Partition: 0    Leader: 2    Replicas: 2    Isr: 2
    Topic: test8    Partition: 1    Leader: 0    Replicas: 0    Isr: 0

<span class="token comment" spellcheck="true"># 验证副本移动是否成功</span>
<span class="token punctuation">[</span>root@node1 bin<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ./kafka-reassign-partitions.sh --zookeeper node1:2181 --reassignment-json-file ./topic-reassignment.json --verify</span>
Status of partition reassignment:
Reassignment of partition test8-0 completed successfully
Reassignment of partition test8-1 completed successfully
</code></pre>
<h3 id="3-2-扩展副本"><a href="#3-2-扩展副本" class="headerlink" title="3.2 扩展副本"></a>3.2 扩展副本</h3><p>把 partitin 0 在broker 1 增加一个副本,把 partitin 1 在broker 1 增加一个副本</p>
<pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true">#首先编辑扩展副本文件</span>
vim add-re.json
<span class="token punctuation">{</span><span class="token string">"partitions"</span>:<span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">"topic"</span><span class="token keyword">:</span><span class="token string">"test8"</span>,<span class="token string">"partition"</span>:0,<span class="token string">"replicas"</span>:<span class="token punctuation">[</span>2,1<span class="token punctuation">]</span><span class="token punctuation">}</span>,<span class="token punctuation">{</span><span class="token string">"topic"</span><span class="token keyword">:</span><span class="token string">"test8"</span>,<span class="token string">"partition"</span>:1,<span class="token string">"replicas"</span>:<span class="token punctuation">[</span>0,1<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">]</span>,<span class="token string">"version"</span>:1<span class="token punctuation">}</span>


<span class="token punctuation">[</span>root@node1 bin<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ./kafka-reassign-partitions.sh --zookeeper node1:2181 --reassignment-json-file ./add-re.json --execute</span>
Current partition replica assignment

<span class="token punctuation">{</span><span class="token string">"version"</span>:1,<span class="token string">"partitions"</span>:<span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">"topic"</span><span class="token keyword">:</span><span class="token string">"test8"</span>,<span class="token string">"partition"</span>:0,<span class="token string">"replicas"</span>:<span class="token punctuation">[</span>2<span class="token punctuation">]</span>,<span class="token string">"log_dirs"</span>:<span class="token punctuation">[</span><span class="token string">"any"</span><span class="token punctuation">]</span><span class="token punctuation">}</span>,<span class="token punctuation">{</span><span class="token string">"topic"</span><span class="token keyword">:</span><span class="token string">"test8"</span>,<span class="token string">"partition"</span>:1,<span class="token string">"replicas"</span>:<span class="token punctuation">[</span>0<span class="token punctuation">]</span>,<span class="token string">"log_dirs"</span>:<span class="token punctuation">[</span><span class="token string">"any"</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span>

Save this to use as the --reassignment-json-file option during rollback
Successfully started reassignment of partitions.

<span class="token comment" spellcheck="true"># 查看分区情况</span>
<span class="token punctuation">[</span>root@node1 bin<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ./kafka-topics.sh --zookeeper node1:2181,node2:2181,node3:2181 --topic test8 --describe</span>
Topic:test8    PartitionCount:2    ReplicationFactor:2    Configs:
    Topic: test8    Partition: 0    Leader: 2    Replicas: 2,1    Isr: 2,1
    Topic: test8    Partition: 1    Leader: 0    Replicas: 0,1    Isr: 0,1

<span class="token comment" spellcheck="true"># 验证副本移动是否成功</span>
<span class="token punctuation">[</span>root@node1 bin<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ./kafka-reassign-partitions.sh --zookeeper node1:2181 --reassignment-json-file ./add-re.json --verify</span>
Status of partition reassignment:
Reassignment of partition test8-0 completed successfully
Reassignment of partition test8-1 completed successfully
</code></pre>
<h2 id="4-kafka-configs-sh"><a href="#4-kafka-configs-sh" class="headerlink" title="4. kafka-configs.sh"></a>4. kafka-configs.sh</h2><ul>
<li>功能：添加/删除topic、client、user或broker的实体配置</li>
</ul>
<p>参数说明</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td><strong>–zookeeper &lt;String: urls&gt;</strong></td>
<td>Zookeeper连接的连接字符串，格式为host:port，多个用逗号隔开</td>
</tr>
<tr>
<td>–describe</td>
<td>列出给定实体的配置。</td>
</tr>
<tr>
<td>–add-config <string></string></td>
<td>要添加的配置的键值对。方括号可用于将包含逗号的值分组:”k1=v1,k2=[v1,v2,v2]，k3=v3”。下面是有效配置的列表:对于entity_type</td>
</tr>
<tr>
<td>–alter</td>
<td>更改实体的配置。</td>
</tr>
<tr>
<td>–delete-config <string></string></td>
<td>从配置中删除配置 key</td>
</tr>
<tr>
<td>–entity-default</td>
<td>客户端/用户的默认实体名称 (applies to   corresponding entity type in command line)</td>
</tr>
<tr>
<td>–entity-name <string></string></td>
<td>实体的名称 (topic name/client id/user principal   name/broker id)</td>
</tr>
<tr>
<td>–entity-type <string></string></td>
<td>实体的类型 (topics/clients/users/brokers)</td>
</tr>
<tr>
<td>–force</td>
<td>禁止控制台提示</td>
</tr>
<tr>
<td>–help</td>
<td>帮助文档</td>
</tr>
</tbody></table>
<h4 id="4-1-查看配置"><a href="#4-1-查看配置" class="headerlink" title="4.1 查看配置"></a>4.1 查看配置</h4><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 查看topic 配置</span>
<span class="token punctuation">[</span>root@node1 bin<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ./kafka-configs.sh --zookeeper node1:2181 --describe --entity-type topics</span>
Configs <span class="token keyword">for</span> topic <span class="token string">'test4'</span> are
Configs <span class="token keyword">for</span> topic <span class="token string">'test5'</span> are
Configs <span class="token keyword">for</span> topic <span class="token string">'test2'</span> are
Configs <span class="token keyword">for</span> topic <span class="token string">'test3'</span> are
Configs <span class="token keyword">for</span> topic <span class="token string">'test8'</span> are
Configs <span class="token keyword">for</span> topic <span class="token string">'test7'</span> are
Configs <span class="token keyword">for</span> topic <span class="token string">'test1'</span> are
Configs <span class="token keyword">for</span> topic <span class="token string">'__consumer_offsets'</span> are segment.bytes<span class="token operator">=</span>104857600,cleanup.policy<span class="token operator">=</span>compact,compression.type<span class="token operator">=</span>producer</code></pre>
<h3 id="4-2-添加配置"><a href="#4-2-添加配置" class="headerlink" title="4.2 添加配置"></a>4.2 添加配置</h3><pre class=" language-bash"><code class="language-bash">
<span class="token punctuation">[</span>root@node1 bin<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ./kafka-configs.sh --zookeeper node1:2181 --alter --entity-type topics --entity-name test1 --add-config flush.ms=5000</span>
Completed Updating config <span class="token keyword">for</span> entity: topic <span class="token string">'test1'</span><span class="token keyword">.</span>
<span class="token punctuation">[</span>root@node1 bin<span class="token punctuation">]</span><span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true">#查看增加的配置</span>
<span class="token punctuation">[</span>root@node1 bin<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ./kafka-configs.sh --zookeeper node1:2181 --describe --entity-type topics</span>
Configs <span class="token keyword">for</span> topic <span class="token string">'test4'</span> are
Configs <span class="token keyword">for</span> topic <span class="token string">'test5'</span> are
Configs <span class="token keyword">for</span> topic <span class="token string">'test2'</span> are
Configs <span class="token keyword">for</span> topic <span class="token string">'test3'</span> are
Configs <span class="token keyword">for</span> topic <span class="token string">'test8'</span> are
Configs <span class="token keyword">for</span> topic <span class="token string">'test7'</span> are
Configs <span class="token keyword">for</span> topic <span class="token string">'test1'</span> are flush.ms<span class="token operator">=</span>5000 <span class="token comment" spellcheck="true"># 刚刚增加的配置</span>
Configs <span class="token keyword">for</span> topic <span class="token string">'__consumer_offsets'</span> are segment.bytes<span class="token operator">=</span>104857600,cleanup.policy<span class="token operator">=</span>compact,compression.type<span class="token operator">=</span>producer
</code></pre>
<h3 id="4-3-删除配置"><a href="#4-3-删除配置" class="headerlink" title="4.3 删除配置"></a>4.3 删除配置</h3><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 删除配置</span>
<span class="token punctuation">[</span>root@node1 bin<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ./kafka-configs.sh --zookeeper node1:2181 --alter --entity-type topics --entity-name test1 --delete-config  flush.ms</span>
Completed Updating config <span class="token keyword">for</span> entity: topic <span class="token string">'test1'</span><span class="token keyword">.</span>
<span class="token comment" spellcheck="true"># 查看topic配置</span>
<span class="token punctuation">[</span>root@node1 bin<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ./kafka-configs.sh --zookeeper node1:2181 --describe --entity-type topics</span>
Configs <span class="token keyword">for</span> topic <span class="token string">'test4'</span> are
Configs <span class="token keyword">for</span> topic <span class="token string">'test5'</span> are
Configs <span class="token keyword">for</span> topic <span class="token string">'test2'</span> are
Configs <span class="token keyword">for</span> topic <span class="token string">'test3'</span> are
Configs <span class="token keyword">for</span> topic <span class="token string">'test8'</span> are
Configs <span class="token keyword">for</span> topic <span class="token string">'test7'</span> are
Configs <span class="token keyword">for</span> topic <span class="token string">'test1'</span> are <span class="token comment" spellcheck="true">#删掉了上一步增加的配置</span>
Configs <span class="token keyword">for</span> topic <span class="token string">'__consumer_offsets'</span> are segment.bytes<span class="token operator">=</span>104857600,cleanup.policy<span class="token operator">=</span>compact,compression.type<span class="token operator">=</span>producer
</code></pre>
<h2 id="5-kafka-delete-records-sh"><a href="#5-kafka-delete-records-sh" class="headerlink" title="5. kafka-delete-records.sh"></a>5. kafka-delete-records.sh</h2><ul>
<li>功能：<br>参数说</li>
</ul>
<table>
<thead>
<tr>
<th>参数</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td><strong>–bootstrap-server &lt;String: server(s)&gt;</strong></td>
<td>要连接的broker列表</td>
</tr>
<tr>
<td><strong>–offset-json-file &lt;String: Offset json file path&gt;</strong></td>
<td>每个分区具有偏移量的JSON文件。使用的格式是:{“partition “: [{“topic”: “foo”， “partition”: 1， “offset”: 1}]， “version”:1}</td>
</tr>
<tr>
<td>–command-config &lt;String: command config property file path&gt;</td>
<td>要传递给Admin Client的配置的属性文件。</td>
</tr>
</tbody></table>
<h3 id="5-1-删除数据"><a href="#5-1-删除数据" class="headerlink" title="5.1 删除数据"></a>5.1 删除数据</h3><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 首先编辑json文件</span>
vim offset.json
<span class="token punctuation">{</span><span class="token string">"partitions"</span>:<span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">"topic"</span><span class="token keyword">:</span><span class="token string">"test8"</span>, <span class="token string">"partition"</span>:1, <span class="token string">"offset"</span><span class="token keyword">:</span> 5<span class="token punctuation">}</span><span class="token punctuation">]</span>, <span class="token string">"version"</span>:1<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true"># 查看test8 partition 1 offset 状态</span>
<span class="token punctuation">[</span>2020-02-20 16:50:40,821<span class="token punctuation">]</span> WARN WARNING: SimpleConsumerShell is deprecated and will be dropped <span class="token keyword">in</span> a future release following 0.11.0.0. <span class="token punctuation">(</span>kafka.tools.SimpleConsumerShell$<span class="token punctuation">)</span>
next offset <span class="token operator">=</span> 1
1
next offset <span class="token operator">=</span> 2
3
next offset <span class="token operator">=</span> 3
5
next offset <span class="token operator">=</span> 4
7
next offset <span class="token operator">=</span> 5
9
next offset <span class="token operator">=</span> 6
11
next offset <span class="token operator">=</span> 7
13
next offset <span class="token operator">=</span> 8
15
next offset <span class="token operator">=</span> 9
0
next offset <span class="token operator">=</span> 10
2

<span class="token comment" spellcheck="true"># 执行offset 删除</span>

<span class="token punctuation">[</span>root@node1 bin<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ./kafka-delete-records.sh --bootstrap-server node1:9092,node2:9092,node3:9092 --offset-json-file offset.json</span>
Executing records delete operation
Records delete operation completed:
partition: test8-1    low_watermark: 5

<span class="token comment" spellcheck="true"># 再次查看offset状态</span>

<span class="token punctuation">[</span>2020-02-20 16:51:23,834<span class="token punctuation">]</span> WARN WARNING: SimpleConsumerShell is deprecated and will be dropped <span class="token keyword">in</span> a future release following 0.11.0.0. <span class="token punctuation">(</span>kafka.tools.SimpleConsumerShell$<span class="token punctuation">)</span>
next offset <span class="token operator">=</span> 6
11
next offset <span class="token operator">=</span> 7
13
next offset <span class="token operator">=</span> 8
15
next offset <span class="token operator">=</span> 9
0
next offset <span class="token operator">=</span> 10
2

发现offset <span class="token operator">=</span>5 之前的数据都被删除了
</code></pre>
<h3 id="5-2-删除offset-大于现有数据"><a href="#5-2-删除offset-大于现有数据" class="headerlink" title="5.2 删除offset 大于现有数据"></a>5.2 删除offset 大于现有数据</h3><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 将配置文件编辑为：</span>
<span class="token punctuation">{</span><span class="token string">"partitions"</span>:<span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">"topic"</span><span class="token keyword">:</span><span class="token string">"test8"</span>, <span class="token string">"partition"</span>:1, <span class="token string">"offset"</span><span class="token keyword">:</span> 5<span class="token punctuation">}</span><span class="token punctuation">]</span>, <span class="token string">"version"</span>:1<span class="token punctuation">}</span>

<span class="token punctuation">[</span>root@node1 bin<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ./kafka-delete-records.sh --bootstrap-server node1:9092,node2:9092,node3:9092 --offset-json-file offset.json</span>
Executing records delete operation
Records delete operation completed:
partition: test8-1    error: org.apache.kafka.common.errors.OffsetOutOfRangeException: The requested offset is not within the range of offsets maintained by the server.
<span class="token comment" spellcheck="true"># 将会抛出数组下标越界的异常</span></code></pre>
<h3 id="5-3-删除offset-等于现有数据最大offset"><a href="#5-3-删除offset-等于现有数据最大offset" class="headerlink" title="5.3 删除offset 等于现有数据最大offset"></a>5.3 删除offset 等于现有数据最大offset</h3><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 将配置文件编辑为：</span>
<span class="token punctuation">{</span><span class="token string">"partitions"</span>:<span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">"topic"</span><span class="token keyword">:</span><span class="token string">"test8"</span>, <span class="token string">"partition"</span>:1, <span class="token string">"offset"</span><span class="token keyword">:</span> 10<span class="token punctuation">}</span><span class="token punctuation">]</span>, <span class="token string">"version"</span>:1<span class="token punctuation">}</span>

<span class="token punctuation">[</span>root@node1 bin<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ./kafka-delete-records.sh --bootstrap-server node1:9092,node2:9092,node3:9092 --offset-json-file offset.json</span>
Executing records delete operation
Records delete operation completed:
partition: test8-1    low_watermark: 10

<span class="token comment" spellcheck="true"># 查看offset 状态 发现已经没有数据了，也就是将数据清空了</span>
<span class="token punctuation">[</span>root@node2 bin<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ./kafka-simple-consumer-shell.sh --broker-list node1:9092,node2:9092,node3:9092 --topic test8 --partition 1 --print-offsets</span>
</code></pre>
<h2 id="6-kafka-log-dirs-sh"><a href="#6-kafka-log-dirs-sh" class="headerlink" title="6. kafka-log-dirs.sh"></a>6. kafka-log-dirs.sh</h2><ul>
<li>功能：</li>
</ul>
<p>参数说明</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td><strong>–bootstrap-server &lt;String: The server (s) to use for bootstrapping&gt;</strong></td>
<td>要连接的broker列表</td>
</tr>
<tr>
<td>–broker-list &lt;String: Broker list&gt;</td>
<td>要查询的broker列表，格式为”0,1,2”。 如果未指定列表，将查询集群中的所有broker</td>
</tr>
<tr>
<td>–describe</td>
<td>描述指定broker上的指定日志目录。</td>
</tr>
<tr>
<td>–topic-list &lt;String: Topic list&gt;</td>
<td>要查询的主题列表，形式为”topic1，topic2，topic3”。 如果未指定主题列表，将查询所有主题</td>
</tr>
</tbody></table>
<pre class=" language-bash"><code class="language-bash">

<span class="token punctuation">[</span>root@node2 bin<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ./kafka-log-dirs.sh --bootstrap-server node1:9092,node2:9092,node3:9092 --describe --topic-list test1,test2</span>
Querying brokers <span class="token keyword">for</span> log directories information
Received log directory information from brokers 0,1,2

<span class="token punctuation">{</span>
    <span class="token string">"version"</span><span class="token keyword">:</span> 1,
    <span class="token string">"brokers"</span><span class="token keyword">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token string">"broker"</span><span class="token keyword">:</span> 0,
            <span class="token string">"logDirs"</span><span class="token keyword">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    <span class="token string">"logDir"</span><span class="token keyword">:</span> <span class="token string">"/opt/kafka_2.12-1.0.2/kafka-logs"</span>,
                    <span class="token string">"error"</span><span class="token keyword">:</span> null,
                    <span class="token string">"partitions"</span><span class="token keyword">:</span> <span class="token punctuation">[</span>
                        <span class="token punctuation">{</span>
                            <span class="token string">"partition"</span><span class="token keyword">:</span> <span class="token string">"test2-1"</span>,
                            <span class="token string">"size"</span><span class="token keyword">:</span> 0,
                            <span class="token string">"offsetLag"</span><span class="token keyword">:</span> 0,
                            <span class="token string">"isFuture"</span><span class="token keyword">:</span> <span class="token boolean">false</span>
                        <span class="token punctuation">}</span>,
                        <span class="token punctuation">{</span>
                            <span class="token string">"partition"</span><span class="token keyword">:</span> <span class="token string">"test1-1"</span>,
                            <span class="token string">"size"</span><span class="token keyword">:</span> 17460,
                            <span class="token string">"offsetLag"</span><span class="token keyword">:</span> 0,
                            <span class="token string">"isFuture"</span><span class="token keyword">:</span> <span class="token boolean">false</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">]</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>,
        <span class="token punctuation">{</span>
            <span class="token string">"broker"</span><span class="token keyword">:</span> 1,
            <span class="token punctuation">..</span>.
        <span class="token punctuation">}</span>,
        <span class="token punctuation">{</span>
            <span class="token string">"broker"</span><span class="token keyword">:</span> 2,
            <span class="token punctuation">..</span>.
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

</code></pre>
<h2 id="7-kafka-preferred-replica-election-sh"><a href="#7-kafka-preferred-replica-election-sh" class="headerlink" title="7. kafka-preferred-replica-election.sh"></a>7. kafka-preferred-replica-election.sh</h2><ul>
<li>功能：手动partition leader 均衡</li>
</ul>
<p>参数说明<br>kafka提供了一个参数auto.leader.rebalance.enable自动做这件事情，且默认为true，原理是一个后台线程检查并触发leader balance。但是并不建议把这个参数设置为true。因为担心这个自动选举发生在业务高峰期，从而导致影响业务。</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td><strong>–zookeeper &lt;String: urls&gt;</strong></td>
<td>Zookeeper连接的连接字符串，格式为host:port，多个用逗号隔开</td>
</tr>
<tr>
<td>–path-to-json-file &lt;String: list of  partitions for which preferred  replica leader election needs to be triggered&gt;</td>
<td>JSON文件中包含了一个分区列表，优先选择的是哪个分区，格式如下:{“partitions”: [{“topic”: “foo”， “partition”: 1}， {“topic”: “foobar”， “partition”: 2}]}默认为所有现有分区</td>
</tr>
</tbody></table>
<pre class=" language-bash"><code class="language-bash">vim leader.json
<span class="token punctuation">{</span><span class="token string">"partitions"</span>:<span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">"topic"</span><span class="token keyword">:</span> <span class="token string">"test3"</span>, <span class="token string">"partition"</span><span class="token keyword">:</span> 0<span class="token punctuation">}</span>,<span class="token punctuation">{</span><span class="token string">"topic"</span><span class="token keyword">:</span> <span class="token string">"test3"</span>, <span class="token string">"partition"</span><span class="token keyword">:</span> 1<span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token string">"topic"</span><span class="token keyword">:</span> <span class="token string">"test3"</span>, <span class="token string">"partition"</span><span class="token keyword">:</span> 2<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span>

<span class="token comment" spellcheck="true"># 首先查看topic test3 的副本leader分布情况，发现所有的leader都在 broker 2 上面</span>
<span class="token punctuation">[</span>root@node2 bin<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ./kafka-topics.sh --zookeeper node1:2181,node2:2181,node3:2181 --topic test3 --describe</span>
Topic:test3    PartitionCount:3    ReplicationFactor:3    Configs:
    Topic: test3    Partition: 0    Leader: 2    Replicas: 1,2,0    Isr: 2,0,1
    Topic: test3    Partition: 1    Leader: 2    Replicas: 2,0,1    Isr: 2,0,1
    Topic: test3    Partition: 2    Leader: 2    Replicas: 0,1,2    Isr: 2,0,1

<span class="token comment" spellcheck="true"># 对副本leader进行均衡分布</span>
<span class="token punctuation">[</span>root@node2 bin<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ./kafka-preferred-replica-election.sh --zookeeper node1:2181,node2:2181,node3:2181 --path-to-json-file ./leader.json</span>
Created preferred replica election path with <span class="token punctuation">{</span><span class="token string">"version"</span>:1,<span class="token string">"partitions"</span>:<span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">"topic"</span><span class="token keyword">:</span><span class="token string">"test3"</span>,<span class="token string">"partition"</span>:0<span class="token punctuation">}</span>,<span class="token punctuation">{</span><span class="token string">"topic"</span><span class="token keyword">:</span><span class="token string">"test3"</span>,<span class="token string">"partition"</span>:1<span class="token punctuation">}</span>,<span class="token punctuation">{</span><span class="token string">"topic"</span><span class="token keyword">:</span><span class="token string">"test3"</span>,<span class="token string">"partition"</span>:2<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
Successfully started preferred replica election <span class="token keyword">for</span> partitions Set<span class="token punctuation">(</span>test3-0, test3-1, test3-2<span class="token punctuation">)</span>
<span class="token punctuation">[</span>root@node2 bin<span class="token punctuation">]</span><span class="token comment" spellcheck="true">#</span>

<span class="token comment" spellcheck="true"># 再次查看leader 分布情况，能够看到已经按照配置文件中的设置进行分布了</span>
<span class="token punctuation">[</span>root@node2 bin<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ./kafka-topics.sh --zookeeper node1:2181,node2:2181,node3:2181 --topic test3 --describe</span>
Topic:test3    PartitionCount:3    ReplicationFactor:3    Configs:
    Topic: test3    Partition: 0    Leader: 1    Replicas: 1,2,0    Isr: 2,0,1
    Topic: test3    Partition: 1    Leader: 2    Replicas: 2,0,1    Isr: 2,0,1
    Topic: test3    Partition: 2    Leader: 0    Replicas: 0,1,2    Isr: 2,0,1
</code></pre>
<h2 id="8-kafka-replica-verification-sh"><a href="#8-kafka-replica-verification-sh" class="headerlink" title="8. kafka-replica-verification.sh"></a>8. kafka-replica-verification.sh</h2><ul>
<li>功能：验证topic的所有副本的同步数据情况</li>
</ul>
<p>参数说明</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td><strong>–broker-list <a href="String:servers" target="_blank" rel="noopener">String:servers</a></strong></td>
<td>要连接的broker</td>
</tr>
<tr>
<td>–fetch-size &lt;Integer: bytes&gt;</td>
<td>每个请求的获取大小(default: 1048576)</td>
</tr>
<tr>
<td>–max-wait-ms &lt;Integer: ms&gt;</td>
<td>每个fetch请求的最大等待时间。(default: 1000)</td>
</tr>
<tr>
<td>–report-interval-ms &lt;Long: ms&gt;</td>
<td>报告时间间隔。(default:  30000)</td>
</tr>
<tr>
<td>–time &lt;Long: timestamp/-1(latest)/-2 (earliest)&gt;</td>
<td>获取初始偏移量的时间戳。(default: -1)</td>
</tr>
<tr>
<td>–topic-white-list &lt;String: Java regex  (String)&gt;</td>
<td>验证副本一致性的主题白列表。默认为所有主题。 (default: .*)</td>
</tr>
</tbody></table>
<pre class=" language-bash"><code class="language-bash">
<span class="token punctuation">[</span>root@node2 bin<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ./kafka-replica-verification.sh --broker-list node1:9092,node2:9092,node3:9092  --topic-white-list test3</span>
2020-02-20 17:15:12,267: verification process is started.
2020-02-20 17:15:42,208: max lag is 0 <span class="token keyword">for</span> partition test3-0 at offset 14 among 3 partitions
2020-02-20 17:16:12,209: max lag is 0 <span class="token keyword">for</span> partition test3-0 at offset 14 among 3 partitions
2020-02-20 17:16:42,210: max lag is 0 <span class="token keyword">for</span> partition test3-0 at offset 14 among 3 partitions

<span class="token comment" spellcheck="true"># 上面输出信息表示为这个topic的复制没有任何延迟</span>
</code></pre>
<h2 id="9-kafka-mirror-maker-sh"><a href="#9-kafka-mirror-maker-sh" class="headerlink" title="9. kafka-mirror-maker.sh"></a>9. kafka-mirror-maker.sh</h2><ul>
<li>功能：集群镜像工具，实现kafka集群间的数据同步，mirror maker进程可以同时开启多个，提高吞吐量。如果其中一个进程挂了，其他线程还能接管其同步任务</li>
</ul>
<p>参数说明</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>–abort.on.send.failure &lt;String: Stop the entire mirror maker when a send failure occurs&gt;</td>
<td>将镜像生成器配置为在发送失败时退出。(default: true)</td>
</tr>
<tr>
<td>–blacklist &lt;String: Java regex (String)&gt;</td>
<td>要镜像的主题的黑名单。只有老客户支持黑名单。</td>
</tr>
<tr>
<td>–consumer.config &lt;String: config file&gt;</td>
<td>用于从源集群消费的Consumer配置。</td>
</tr>
<tr>
<td>–consumer.rebalance.listener &lt;String: A custom rebalance listener of type   ConsumerRebalanceListener&gt;</td>
<td>消费者再平衡监听器用于镜像制造商消费者。</td>
</tr>
<tr>
<td>–message.handler &lt;String: A custom message handler of type  MirrorMakerMessageHandler&gt;</td>
<td>消息处理程序，它将处理消费者和生产者之间的每条记录。</td>
</tr>
<tr>
<td>–message.handler.args &lt;String: Arguments passed to message handler constructor.&gt;</td>
<td>自定义消息处理程序为镜像生成器使用的参数</td>
</tr>
<tr>
<td>–new.consumer</td>
<td>在镜像生成器中使用新用户(这是默认设置)。</td>
</tr>
<tr>
<td>–num.streams &lt;Integer: Number of  threads&gt;</td>
<td>消费流的数量，默认1</td>
</tr>
<tr>
<td>–offset.commit.interval.ms &lt;Integer:offset commit interval in millisecond&gt;</td>
<td>提交offset的时间间隔，单位毫秒default: 60000)</td>
</tr>
<tr>
<td>–producer.config &lt;String: config file&gt;</td>
<td>Embedded producer config.</td>
</tr>
<tr>
<td>–rebalance.listener.args &lt;String: Arguments passed to custom rebalance  listener constructor as a string.&gt;</td>
<td>自定义重新平衡侦听器用于镜像生成器使用者的参数。</td>
</tr>
<tr>
<td>–whitelist &lt;String: Java regex (String)&gt;</td>
<td>镜像topic的白名单。</td>
</tr>
<tr>
<td>–help</td>
<td>打印帮助信息</td>
</tr>
</tbody></table>
<pre class=" language-bash"><code class="language-bash">./kafka-run-class.sh kafka.tools.MirrorMaker --consumer.config consumer.properties --num.streams 2 --producer.config producer.properties --whitelist<span class="token operator">=</span><span class="token string">"test*"</span></code></pre>
<p>consumer.config 配置示例</p>
<pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 指定消费者</span>
group.id<span class="token operator">=</span>group-designer
<span class="token comment" spellcheck="true"># 这是一个数量阈值，经测试是500条,当consumer消费一定量的消息之后,将会自动向zookeeper提交offset信息#注意offset信息并不是每消费一次消息就向zk提交一次,而是现在本地保存(内存),并定期提交,默认为true</span>
auto.commit.enable<span class="token operator">=</span>true
<span class="token comment" spellcheck="true"># 自动更新时间。默认60 * 1000</span>
auto.commit.interval.ms<span class="token operator">=</span>1000
<span class="token comment" spellcheck="true"># 当前consumer的标识,可以设定,也可以有系统生成,主要用来跟踪消息消费情况,便于观察</span>
conusmer.id<span class="token operator">=</span>xxx
<span class="token comment" spellcheck="true"># 消费者客户端编号，用于区分不同客户端，默认客户端程序自动产生</span>
client.id<span class="token operator">=</span>xxxx
<span class="token comment" spellcheck="true"># 最大取多少块缓存到消费者(默认10)</span>
queued.max.message.chunks<span class="token operator">=</span>50
<span class="token comment" spellcheck="true"># zookeeper地址</span>
zookeeper.connect<span class="token operator">=</span>node1:2181,node2:2181,node3:2181
<span class="token comment" spellcheck="true"># zookeeper的session过期时间，默认5000ms，用于检测消费者是否挂掉</span>
zookeeper.connection.timeout.ms<span class="token operator">=</span>6000
<span class="token comment" spellcheck="true"># 当消费者挂掉，其他消费者要等该指定时间才能检查到并且触发重新负载均衡</span>
zookeeper.connection.timeout.ms<span class="token operator">=</span>10000
<span class="token comment" spellcheck="true"># 这是一个时间阈值,指定多久消费者更新offset到zookeeper中,注意offset更新时基于time而不是每次获得的消息,一旦在更新zookeeper发生异常并重启，将可能拿到已拿到过的消息</span>
zookeeper.sync.time.ms<span class="token operator">=</span>2000
<span class="token comment" spellcheck="true"># 当有新的consumer加入到group时,将会reblance,此后将会有partitions的消费端迁移到新 的consumer上,如果一个consumer获得了某个partition的消费权限,那么它将会向zk注册 "Partition Owner registry"节点信息,但是有可能此时旧的consumer尚没有释放此节点, 此值用于控制,注册节点的重试次>数.</span>
rebalance.max.retries<span class="token operator">=</span>5
<span class="token comment" spellcheck="true"># 每拉取一批消息的最大字节数,获取消息的最大尺寸,broker不会像consumer输出大于此值的消息chunk 每次feth将得到多条消息,此值为总大小,提升此值,将会消耗更多的consumer端内存</span>
fetch.min.bytes<span class="token operator">=</span>1048576
<span class="token comment" spellcheck="true"># 当消息的尺寸不足时,server阻塞的时间,如果超时,消息将立即发送给consumer,数据一批一批到达，如果每一批是10条消息，如果某一批还不到10条，但是超时了，也会立即发送给consumer。</span>
fetch.wait.max.ms<span class="token operator">=</span>5000
socket.receive.buffer.bytes<span class="token operator">=</span>655360
<span class="token comment" spellcheck="true"># 如果zookeeper没有offset值或offset值超出范围,那么就给个初始的offset。有smallest、largest、anything可选，分别表示给当前最小的offset 当前最大的offset 抛异常。默认largest</span>
auto.offset.reset<span class="token operator">=</span>largest
<span class="token comment" spellcheck="true"># 指定序列化处理类</span>
derializer.class<span class="token operator">=</span>kafka.serializer.DefaultDecoder
</code></pre>
<p>producer.config 配置示例</p>
<pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 源集群</span>
bootstrap.servers<span class="token operator">=</span>node1:9092,node2:9092,node3:9092
acks<span class="token operator">=</span>all
retries<span class="token operator">=</span>3
producer.type<span class="token operator">=</span>async
<span class="token comment" spellcheck="true"># 批次大点，增加点吞吐量性能</span>
batch.size<span class="token operator">=</span>16384
buffer.memory<span class="token operator">=</span>33554432
linger.ms<span class="token operator">=</span>1</code></pre>
<h2 id="10-kafka-acls-sh"><a href="#10-kafka-acls-sh" class="headerlink" title="10. kafka-acls.sh"></a>10. kafka-acls.sh</h2><ul>
<li>功能：</li>
</ul>
<p>参数说明</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td><strong>–authorizer-properties &lt;String: authorizer-properties&gt;</strong></td>
<td>配置Authorizer实例所需的属性。 KV对. 默认示例：connect=localhost:2181</td>
</tr>
<tr>
<td>–add</td>
<td>添加ACL。</td>
</tr>
<tr>
<td>–allow-host &lt;String: allow-host&gt;</td>
<td>–allow-principal中列出的主体可以访问的主机。如果您指定了–allow-principal，则此选项的默认值将设置为*，允许从所有主机进行访问。</td>
</tr>
<tr>
<td>–allow-principal &lt;String: allow-principal&gt;</td>
<td>principal is in principalType:name  format. Note that principalType must  be supported by the Authorizer being  used. For example, User:* is the  wild card indicating all users.</td>
</tr>
<tr>
<td>–authorizer &lt;String: authorizer&gt;</td>
<td>授权方的完全限定类名，(默认:kafka.security.auth.SimpleAclAuthorizer)</td>
</tr>
<tr>
<td>–cluster</td>
<td>添加/删除集群acl。</td>
</tr>
<tr>
<td>–consumer</td>
<td>为使用者角色添加/删除acl的方便选项。这将生成允许读、主题描述和组读的acl。</td>
</tr>
<tr>
<td>–deny-host &lt;String: deny-host&gt;</td>
<td>拒绝访问–deny-principal中列出的主体所在的主机。如果您指定了–deny–principal，那么这个选项的默认值将设置为*，它拒绝所有主机的访问。</td>
</tr>
<tr>
<td>–deny-principal &lt;String: deny- principal&gt;</td>
<td>principal is in principalType:name format. By default anyone not added through –allow-principal is denied access. You only need to use this option as negation to already allowed set. Note that principalType must be supported by the Authorizer being used. For example if you wanted to allow access to all users in the system but not test-user you can define an ACL that allows access to User:* and specify –deny- principal=User:<a href="mailto:test@EXAMPLE.COM" target="_blank" rel="noopener">test@EXAMPLE.COM</a>. AND PLEASE REMEMBER DENY RULES TAKES PRECEDENCE OVER ALLOW RULES.</td>
</tr>
<tr>
<td>–force</td>
<td>假设所有操作都是yes，规避提示</td>
</tr>
<tr>
<td>–group &lt;String: group&gt;</td>
<td>应该添加或删除acl的使用者组。值*表示acl应该应用于所有组。</td>
</tr>
<tr>
<td>–idempotent</td>
<td>为生产者启用幂等性。这应该与—producer选项结合使用。注意，如果生产者被授权给特定的事务id，则自动启用幂等性。</td>
</tr>
<tr>
<td>–list</td>
<td>列出指定资源的acl，使用–topic 或–group 或–cluster指定资源。</td>
</tr>
<tr>
<td>–operation <string></string></td>
<td>允许或拒绝的操作。有效的操作名是:Read Write Create Delete Alter Describe ClusterAction AlterConfigs Describe beconfigs IdempotentWrite All(默认:All)</td>
</tr>
<tr>
<td>–producer</td>
<td>方便的选项添加/删除生产者角色的acl。这将生成允许写、主题描述和在集群上创建的acl。</td>
</tr>
<tr>
<td>–remove</td>
<td>删除acl。</td>
</tr>
<tr>
<td>–topic &lt;String: topic&gt;</td>
<td>应该添加或删除哪些acl的主题。值*表示ACL应该应用于所有主题。</td>
</tr>
<tr>
<td>–transactional-id <a href="String:transactional-id" target="_blank" rel="noopener">String:transactional-id</a></td>
<td>应该添加或删除acl的transactionalId。值*表示acl应该应用于所有transactionalid。</td>
</tr>
<tr>
<td>–help</td>
<td>帮助文档</td>
</tr>
</tbody></table>
<pre class=" language-bash"><code class="language-bash"></code></pre>
<h2 id="11-kafka-streams-application-reset-sh"><a href="#11-kafka-streams-application-reset-sh" class="headerlink" title="11. kafka-streams-application-reset.sh"></a>11. kafka-streams-application-reset.sh</h2><ul>
<li>功能：<br>参数说明<ul>
<li>参数1</li>
<li>参数2</li>
</ul>
</li>
</ul>
<p>The Streams Reset Tool allows you to quickly reset an application in order to reprocess its data from scratch.</p>
<ul>
<li>This tool resets offsets of input topics to the earliest available offset and it skips to the end of intermediate topics (topics used in the through() method).</li>
<li>This tool deletes the internal topics that were created by Kafka Streams (topics starting with “&lt;application.id&gt;-“).<br>You do not need to specify internal topics because the tool finds them automatically.</li>
<li>This tool will not delete output topics (if you want to delete them, you need to do it yourself with the bin/kafka-topics.sh command).</li>
<li>This tool will not clean up the local state on the stream application instances (the persisted stores used to cache aggregation results).<br>You need to call KafkaStreams#cleanUp() in your application or manually delete them from the directory specified by “state.dir” configuration (/tmp/kafka-streams/&lt;application.id&gt; by default).</li>
</ul>
<p>*** 重要!如果您在运行重置工具后需要清理本地存储，否则会有错误的输出!</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td><strong>–application-id &lt;String: id&gt;</strong></td>
<td>The Kafka Streams application ID。(application.id).</td>
</tr>
<tr>
<td>–bootstrap-servers &lt;String: urls&gt;</td>
<td>broker列表</td>
</tr>
<tr>
<td>–config-file &lt;String: file name&gt;</td>
<td>包含要传递给client和consumer的配置的属性文件。</td>
</tr>
<tr>
<td>–dry-run</td>
<td>显示将在不执行复位命令的情况下执行的操作。</td>
</tr>
<tr>
<td>–input-topics &lt;String: list&gt;</td>
<td>逗号分隔的用户输入topic列表。对于这些主题，工具将把offset重置为最早可用的offset。</td>
</tr>
<tr>
<td>–intermediate-topics &lt;String: list&gt;</td>
<td>中间用户主题(在through()方法中使用的主题)的逗号分隔列表。对于这些主题，工具将跳到最后。</td>
</tr>
</tbody></table>
<pre class=" language-bash"><code class="language-bash"></code></pre>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://www.hnbian.cn" rel="external nofollow noreferrer">hnbian</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://www.hnbian.cn/posts/d95dd816.html">https://www.hnbian.cn/posts/d95dd816.html</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="https://www.hnbian.cn" target="_blank">hnbian</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/kafka/">
                                    <span class="chip bg-color">kafka</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">

<div id="article-share">
    
    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.jpg" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>
            
        </div>
    </div>

    

    

    

    

    
        <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments textarea {
        box-sizing: border-box;
        background: url("/medias/comment_bg.png") 100% 100% no-repeat;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #4cbf30;
        font-weight: 500;
        text-decoration: none;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="vcomments" class="card-content" style="display: grid">
    </div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="https://unpkg.com/valine/dist/Valine.min.js"></script>
<script>
    new Valine({
        el: '#vcomments',
        appId: 'h1rND3bHC0OqFwzm1UfPQpaY-gzGzoHsz',
        appKey: 'd7uboDt2WLV2HJCEMHkkLuU4',
        notify: 'true' === 'true',
        verify: 'false' === 'true',
        visitor: 'true' === 'true',
        avatar: 'identicon',
        pageSize: '10',
        lang: 'zh-cn',
        placeholder: ' 写点什么吧 . . .'
    });
</script>

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/posts/366f37cf.html">
                    <div class="card-image">
                        
                        <img src="https://images.hnbian.cn/Ftu1QqD8d-9bl0c1ZjuoInAldNug" class="responsive-img" alt="Kafka总结（六）Kafka 安全性保障">
                        
                        <span class="card-title">Kafka总结（六）Kafka 安全性保障</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            1. ssl/tls 原理
摘要算法：将需要加密的铭文使用hash函数生成一段被称为摘要的遗传密文，128位

数字签名：将摘要使用私钥加密后连同明文一同发送，接收方使用公钥将其解密为摘要，然后使用hash函数从明文算出摘要，将二者进行对比
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2020-02-20
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/kafka/" class="post-category">
                                    kafka
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/kafka/">
                        <span class="chip bg-color">kafka</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/posts/8dea4499.html">
                    <div class="card-image">
                        
                        <img src="https://images.hnbian.cn/FoiPH-JVTiWESh9aP8SDDa3tnsIj" class="responsive-img" alt="Kafka总结（五）Kafka 命令行详解上、topic、producer、consumer相关命令">
                        
                        <span class="card-title">Kafka总结（五）Kafka 命令行详解上、topic、producer、consumer相关命令</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
脚本列表




序号
脚本
功能



1
kafka-server-start.sh
启动kafka服务


2
kafka-server-stop.sh
停止kafka服务


3
kafka-topics.sh
topic管理脚本
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2020-02-16
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/kafka/" class="post-category">
                                    kafka
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/kafka/">
                        <span class="chip bg-color">kafka</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>

    
<!-- 代码块复制 -->


<!-- 代码块收缩 -->


<!-- 代码块折行 -->

<style type="text/css">
code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }
</style>

    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="https://images.hnbian.cn/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4, h5'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4, h5').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>



    <footer class="page-footer bg-color">
    <div class="container row center-align" style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            <span id="year">2018</span>
            <a href="https://www.hnbian.cn" target="_blank">hnbian</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                class="white-color">812.8k</span>&nbsp;字
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <span id="sitetime">载入运行时间...</span>
            <script>
                function siteTime() {
                    var seconds = 1000;
                    var minutes = seconds * 60;
                    var hours = minutes * 60;
                    var days = hours * 24;
                    var years = days * 365;
                    var today = new Date();
                    var startYear = "2018";
                    var startMonth = "2";
                    var startDate = "08";
                    var startHour = "0";
                    var startMinute = "0";
                    var startSecond = "0";
                    var todayYear = today.getFullYear();
                    var todayMonth = today.getMonth() + 1;
                    var todayDate = today.getDate();
                    var todayHour = today.getHours();
                    var todayMinute = today.getMinutes();
                    var todaySecond = today.getSeconds();
                    var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                    var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                    var diff = t2 - t1;
                    var diffYears = Math.floor(diff / years);
                    var diffDays = Math.floor((diff / days) - diffYears * 365);
                    var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
                    var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) /
                        minutes);
                    var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours -
                        diffMinutes * minutes) / seconds);
                    if (startYear == todayYear) {
                        document.getElementById("year").innerHTML = todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffDays + " 天 " + diffHours +
                            " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    } else {
                        document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffYears + " 年 " + diffDays +
                            " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    }
                }
                setInterval(siteTime, 1000);
            </script>
            
            <br>
            
            <span id="icp"><img src="/medias/icp.png" style="vertical-align: text-bottom;" />
                <a href="https://beian.miit.gov.cn" target="_blank">粤ICP备18156920号-2</a>
            </span>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/hnbian" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:hnbian@126.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>













</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/" + "search.xml", 'searchInput', 'searchResult');
});
</script>
    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="https://images.hnbian.cn/materialize.min.js"></script>
    <script src="https://images.hnbian.cn/masonry.pkgd.min.js"></script>
    <script src="https://images.hnbian.cn/aos.js"></script>
    <script src="https://images.hnbian.cn/scrollProgress.min.js"></script>
    <script src="https://images.hnbian.cn/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Global site tag (gtag.js) - Google Analytics -->

    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-155985521-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-155985521-1');
    </script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="https://images.hnbian.cn/clicklove.js" async="async"></script>
    
    
    <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    

    

    

    

    

    
    <script type="text/javascript" src="https://images.hnbian.cn/ribbon-dynamic.js" async="async"></script>
    
    
    
    <script src="https://images.hnbian.cn/instantpage.js" type="module"></script>
    

</body>

</html>
